<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運動記録アプリ</title>
    
    <!-- PWA対応メタタグ -->
    <meta name="theme-color" content="#2196F3">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="運動記録">
    
    <!-- PWA manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- アイコン -->
    <link rel="icon" href="./icon-192.png" type="image/png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        body.dark-mode .container {
            background: #2c3e50;
            color: white;
        }

        body.dark-mode .exercise-btn {
            background: #34495e;
            border-color: #4a5568;
            color: white;
        }

        body.dark-mode .exercise-btn:hover {
            background: #4a5568;
        }

        body.dark-mode .input-section {
            background: #34495e;
        }

        body.dark-mode .input-group input {
            background: #2c3e50;
            color: white;
            border-color: #4a5568;
        }

        body.dark-mode .log-entry {
            background: #34495e;
            color: white;
        }

        body.dark-mode .calendar-container {
            background: #34495e;
        }

        body.dark-mode .calendar-day {
            background: #2c3e50;
            color: white;
        }

        body.dark-mode .calendar-day.other-month {
            background: #1a252f;
            color: #666;
        }

        body.dark-mode .stats-card {
            background: #34495e;
            color: white;
        }

        body.dark-mode .progress-item {
            background: #34495e;
            color: white;
        }

        body.dark-mode .favorite-item {
            background: #34495e;
            color: white;
        }

        body.dark-mode .chart-container {
            background: #34495e;
        }

        body.dark-mode .add-favorite-form {
            background: #34495e;
        }

        /* インストール促進バナー */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #2196F3;
            color: white;
            padding: 15px;
            display: none;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .install-banner.show {
            display: flex;
        }

        .install-text {
            flex: 1;
            font-size: 14px;
        }

        .install-buttons {
            display: flex;
            gap: 10px;
        }

        .install-btn, .dismiss-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .install-btn {
            background: white;
            color: #2196F3;
        }

        .dismiss-btn {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .dark-mode-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 80px;
            padding: 15px 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab.active {
            background: #2196F3;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .exercise-selection {
            margin-bottom: 30px;
        }

        .exercise-category {
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .exercise-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .exercise-btn {
            padding: 15px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .exercise-btn:hover {
            background: #e9ecef;
            border-color: #2196F3;
        }

        .exercise-btn.selected {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .input-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .input-section.active {
            display: block;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            border-color: #2196F3;
            outline: none;
        }

        .record-btn {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .record-btn:hover {
            background: #45a049;
        }

        .workout-log {
            margin-top: 30px;
        }

        .log-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .log-entry {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        .log-entry .date {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .log-entry .exercise-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .log-entry .details {
            font-size: 14px;
            color: #555;
        }

        .clear-log-btn {
            width: 100%;
            padding: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
        }

        .clear-log-btn:hover {
            background: #d32f2f;
        }

        .calendar-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .calendar-nav:hover {
            background: #1976D2;
        }

        .calendar-nav:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .calendar-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day-header {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #666;
            font-size: 14px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
            border-radius: 5px;
        }

        .calendar-day:hover {
            background: #e3f2fd;
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f5f5f5;
        }

        .calendar-day.today {
            border: 3px solid #2196F3;
            font-weight: bold;
        }

        .calendar-day.has-workout {
            color: #333;
            font-weight: bold;
        }

        .calendar-day .exercise-indicator {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            border-radius: 5px;
        }

        .calendar-day .cardio-indicator {
            background: rgba(33, 150, 243, 0.7);
        }

        .calendar-day .strength-indicator {
            background: rgba(244, 67, 54, 0.7);
        }

        .calendar-day .ssc-indicator {
            background: rgba(255, 193, 7, 0.7);
        }

        .calendar-day .other-indicator {
            background: rgba(76, 175, 80, 0.7);
        }

        .calendar-day .cardio-strength {
            background: linear-gradient(45deg, rgba(33, 150, 243, 0.7) 50%, rgba(244, 67, 54, 0.7) 50%);
        }

        .calendar-day .cardio-ssc {
            background: linear-gradient(-45deg, rgba(33, 150, 243, 0.7) 50%, rgba(255, 193, 7, 0.7) 50%);
        }

        .calendar-day .cardio-other {
            background: linear-gradient(-45deg, rgba(33, 150, 243, 0.7) 50%, rgba(76, 175, 80, 0.7) 50%);
        }

        .calendar-day .strength-ssc {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.7) 50%, rgba(255, 193, 7, 0.7) 50%);
        }

        .calendar-day .strength-other {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.7) 50%, rgba(76, 175, 80, 0.7) 50%);
        }

        .calendar-day .ssc-other {
            background: linear-gradient(45deg, rgba(255, 193, 7, 0.7) 50%, rgba(76, 175, 80, 0.7) 50%);
        }

        /* 3種目の組み合わせ（アルファベット順） */
        .calendar-day .cardio-ssc-strength {
            background: conic-gradient(rgba(33, 150, 243, 0.7) 0deg 120deg, rgba(255, 193, 7, 0.7) 120deg 240deg, rgba(244, 67, 54, 0.7) 240deg 360deg);
        }

        .calendar-day .cardio-other-strength {
            background: conic-gradient(rgba(33, 150, 243, 0.7) 0deg 120deg, rgba(76, 175, 80, 0.7) 120deg 240deg, rgba(244, 67, 54, 0.7) 240deg 360deg);
        }

        .calendar-day .cardio-other-ssc {
            background: conic-gradient(rgba(33, 150, 243, 0.7) 0deg 120deg, rgba(76, 175, 80, 0.7) 120deg 240deg, rgba(255, 193, 7, 0.7) 240deg 360deg);
        }

        .calendar-day .other-ssc-strength {
            background: conic-gradient(rgba(76, 175, 80, 0.7) 0deg 120deg, rgba(255, 193, 7, 0.7) 120deg 240deg, rgba(244, 67, 54, 0.7) 240deg 360deg);
        }

        /* 4種目すべて */
        .calendar-day .all-types {
            background: conic-gradient(rgba(33, 150, 243, 0.7) 0deg 90deg, rgba(244, 67, 54, 0.7) 90deg 180deg, rgba(255, 193, 7, 0.7) 180deg 270deg, rgba(76, 175, 80, 0.7) 270deg 360deg);
        }

        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .legend-border {
            width: 12px;
            height: 12px;
            border: 2px solid #2196F3;
            border-radius: 2px;
            background: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stats-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }

        .stats-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .progress-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .progress-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-exercise {
            font-weight: bold;
        }

        .progress-change {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .progress-up {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .progress-down {
            background: #ffebee;
            color: #c62828;
        }

        .progress-same {
            background: #e3f2fd;
            color: #1976d2;
        }

        .favorites-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .favorite-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            position: relative;
        }

        .favorite-name {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .favorite-exercises {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .favorite-actions {
            display: flex;
            gap: 10px;
        }

        .favorite-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .use-favorite {
            background: #4CAF50;
            color: white;
        }

        .delete-favorite {
            background: #f44336;
            color: white;
        }

        .add-favorite-form {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .chart-label {
            width: 60px;
            font-size: 12px;
        }

        .chart-bar-fill {
            height: 20px;
            background: #2196F3;
            border-radius: 4px;
            margin-right: 8px;
            transition: width 0.5s ease;
        }

        .chart-value {
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 480px) {
            .exercise-buttons {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 0 10px;
            }
            
            .nav-tab {
                font-size: 10px;
                padding: 12px 4px;
            }
            
            .calendar-day {
                font-size: 12px;
            }
            
            .calendar-title {
                font-size: 18px;
            }
            
            .calendar-nav {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .legend-item {
                font-size: 11px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .install-banner {
                padding: 10px;
            }

            .install-text {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- インストール促進バナー -->
    <div id="install-banner" class="install-banner">
        <div class="install-text">
            📱 このアプリをホーム画面に追加できます！
        </div>
        <div class="install-buttons">
            <button class="install-btn" id="install-btn">追加</button>
            <button class="dismiss-btn" id="dismiss-btn">閉じる</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">🌙 ダーク</button>
            <h1>💪 運動記録アプリ</h1>
            <p>今日も頑張りましょう！</p>
        </div>
        
        <div class="content">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('record')">📝 記録</button>
                <button class="nav-tab" onclick="showTab('calendar')">📅 カレンダー</button>
                <button class="nav-tab" onclick="showTab('stats')">📊 統計</button>
                <button class="nav-tab" onclick="showTab('progress')">📈 進捗</button>
                <button class="nav-tab" onclick="showTab('favorites')">⭐ お気に入り</button>
            </div>
            
            <div id="record-tab" class="tab-content active">
                <div class="exercise-selection">
                    <div class="exercise-category">
                        <div class="category-title">🏃‍♂️ 有酸素運動</div>
                        <div class="exercise-buttons">
                            <div class="exercise-btn" data-exercise="エアロバイク" data-type="cardio">エアロバイク</div>
                            <div class="exercise-btn" data-exercise="ランニング" data-type="cardio">ランニング</div>
                            <div class="exercise-btn" data-exercise="散歩" data-type="cardio">散歩</div>
                        </div>
                    </div>
                    
                    <div class="exercise-category">
                        <div class="category-title">💪 筋力トレーニング</div>
                        <div class="exercise-buttons">
                            <div class="exercise-btn" data-exercise="BSQ" data-type="strength">BSQ</div>
                            <div class="exercise-btn" data-exercise="デッドリフト" data-type="strength">デッドリフト</div>
                            <div class="exercise-btn" data-exercise="ダンベルプレス" data-type="strength">ダンベルプレス</div>
                            <div class="exercise-btn" data-exercise="腹筋ローラー" data-type="strength">腹筋ローラー</div>
                        </div>
                    </div>
                    
                    <div class="exercise-category">
                        <div class="category-title">⚡ SSC</div>
                        <div class="exercise-buttons">
                            <div class="exercise-btn" data-exercise="SSC上半身" data-type="ssc">SSC上半身</div>
                            <div class="exercise-btn" data-exercise="SSC下半身" data-type="ssc">SSC下半身</div>
                        </div>
                    </div>
                    
                    <div class="exercise-category">
                        <div class="category-title">🧘‍♀️ その他</div>
                        <div class="exercise-buttons">
                            <div class="exercise-btn" data-exercise="ストレッチ" data-type="other">ストレッチ</div>
                        </div>
                    </div>
                </div>

                <div id="cardio-input" class="input-section">
                    <h3>有酸素運動の記録</h3>
                    <div class="input-group">
                        <label for="cardio-time">運動時間（分）</label>
                        <input type="number" id="cardio-time" min="1">
                    </div>
                    <button class="record-btn" onclick="recordCardio()">記録する</button>
                </div>

                <div id="strength-input" class="input-section">
                    <h3>筋力トレーニングの記録</h3>
                    <div class="input-group">
                        <label for="strength-weight">重量（kg）</label>
                        <input type="number" id="strength-weight" min="0" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="strength-reps">回数</label>
                        <input type="number" id="strength-reps" min="1">
                    </div>
                    <button class="record-btn" onclick="recordStrength()">記録する</button>
                </div>

                <div id="ssc-input" class="input-section">
                    <h3>SSCの記録</h3>
                    <div class="input-group">
                        <label for="ssc-time">運動時間（分）</label>
                        <input type="number" id="ssc-time" min="1">
                    </div>
                    <button class="record-btn" onclick="recordSSC()">記録する</button>
                </div>

                <div id="other-input" class="input-section">
                    <h3>その他の運動の記録</h3>
                    <div class="input-group">
                        <label for="other-time">運動時間（分）</label>
                        <input type="number" id="other-time" min="1">
                    </div>
                    <button class="record-btn" onclick="recordOther()">記録する</button>
                </div>

                <div class="workout-log">
                    <div class="log-title">📝 今日の運動記録</div>
                    <div id="log-container">
                        <p style="color: #666; text-align: center; padding: 20px;">まだ記録がありません</p>
                    </div>
                    <button class="clear-log-btn" onclick="clearLog()">記録をクリア</button>
                </div>
            </div>
            
            <div id="calendar-tab" class="tab-content">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="previousMonth()" id="prev-btn">◀ 前月</button>
                        <div class="calendar-title" id="calendar-title">2024年1月</div>
                        <button class="calendar-nav" onclick="nextMonth()" id="next-btn">次月 ▶</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-day-header">日</div>
                        <div class="calendar-day-header">月</div>
                        <div class="calendar-day-header">火</div>
                        <div class="calendar-day-header">水</div>
                        <div class="calendar-day-header">木</div>
                        <div class="calendar-day-header">金</div>
                        <div class="calendar-day-header">土</div>
                    </div>
                    <div id="calendar-days" class="calendar-grid"></div>
                    <div class="calendar-legend">
                        <div class="legend-item">
                            <div class="legend-border"></div>
                            <span>今日</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #2196F3;"></div>
                            <span>有酸素</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f44336;"></div>
                            <span>筋トレ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #FFC107;"></div>
                            <span>SSC</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4CAF50;"></div>
                            <span>その他</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="stats-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-number" id="total-workouts">0</div>
                        <div class="stats-label">総運動回数</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="total-time">0</div>
                        <div class="stats-label">総運動時間(分)</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="current-streak">0</div>
                        <div class="stats-label">現在の連続日数</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="weekly-avg">0</div>
                        <div class="stats-label">週平均回数</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">週間運動頻度</div>
                    <div id="weekly-chart"></div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">月間運動頻度</div>
                    <div id="monthly-chart"></div>
                </div>
            </div>
            
            <div id="progress-tab" class="tab-content">
                <h3>📈 進捗トラッキング</h3>
                <div id="progress-list" class="progress-list">
                    <p style="color: #666; text-align: center; padding: 20px;">進捗データが表示されます</p>
                </div>
            </div>
            
            <div id="favorites-tab" class="tab-content">
                <div class="add-favorite-form">
                    <h3>新しいお気に入りを作成</h3>
                    <div class="input-group">
                        <label>お気に入り名</label>
                        <input type="text" id="favorite-name" placeholder="例: 上半身ワークアウト">
                    </div>
                    <div id="favorite-builder">
                        <p>運動を選択してお気に入りに追加してください</p>
                    </div>
                    <button class="record-btn" onclick="saveFavorite()">お気に入りを保存</button>
                </div>
                
                <h3>⭐ 保存済みお気に入り</h3>
                <div id="favorites-list" class="favorites-list">
                    <p style="color: #666; text-align: center; padding: 20px;">お気に入りがありません</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentExercise = '';
        let currentType = '';
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let favoriteBuilder = [];
        let deferredPrompt;

        // PWA インストール処理
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallBanner();
        });

        function showInstallBanner() {
            const banner = document.getElementById('install-banner');
            banner.classList.add('show');
        }

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                hideInstallBanner();
            }
        });

        document.getElementById('dismiss-btn').addEventListener('click', () => {
            hideInstallBanner();
        });

        function hideInstallBanner() {
            const banner = document.getElementById('install-banner');
            banner.classList.remove('show');
        }

        // Service Worker 登録
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            const toggle = document.querySelector('.dark-mode-toggle');
            toggle.textContent = isDark ? '☀️ ライト' : '🌙 ダーク';
        }

        function showTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'calendar') {
                renderCalendar();
            } else if (tabName === 'stats') {
                updateStats();
            } else if (tabName === 'progress') {
                updateProgress();
            } else if (tabName === 'favorites') {
                displayFavorites();
            }
        }

        function selectExercise(exerciseName, exerciseType) {
            currentExercise = exerciseName;
            currentType = exerciseType;
            
            document.querySelectorAll('.exercise-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            
            document.querySelectorAll('.input-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(exerciseType + '-input').classList.add('active');
            fillPreviousValues(exerciseName, exerciseType);
        }

        function fillPreviousValues(exerciseName, exerciseType) {
            const workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
            const previousEntries = workoutLog.filter(entry => entry.exercise === exerciseName);
            
            if (exerciseType === 'cardio' || exerciseType === 'other' || exerciseType === 'ssc') {
                let timeValue = '20';
                
                if (previousEntries.length > 0) {
                    const lastEntry = previousEntries[previousEntries.length - 1];
                    const timeMatch = lastEntry.details.match(/運動時間:\s*(\d+)分/);
                    if (timeMatch) {
                        timeValue = timeMatch[1];
                    }
                }
                
                let inputId;
                if (exerciseType === 'cardio') inputId = 'cardio-time';
                else if (exerciseType === 'ssc') inputId = 'ssc-time';
                else inputId = 'other-time';
                
                document.getElementById(inputId).value = timeValue;
                
            } else if (exerciseType === 'strength') {
                let weightValue = '15';
                let repsValue = '10';
                
                if (previousEntries.length > 0) {
                    const lastEntry = previousEntries[previousEntries.length - 1];
                    const weightMatch = lastEntry.details.match(/重量:\s*([\d.]+)kg/);
                    const repsMatch = lastEntry.details.match(/回数:\s*(\d+)回/);
                    
                    if (weightMatch) {
                        weightValue = weightMatch[1];
                    }
                    if (repsMatch) {
                        repsValue = repsMatch[1];
                    }
                }
                
                document.getElementById('strength-weight').value = weightValue;
                document.getElementById('strength-reps').value = repsValue;
            }
        }

        function recordCardio() {
            const time = document.getElementById('cardio-time').value;
            if (!time || !currentExercise) return;
            
            addToLog(currentExercise, `運動時間: ${time}分`);
            resetSelection();
        }

        function recordStrength() {
            const weight = document.getElementById('strength-weight').value;
            const reps = document.getElementById('strength-reps').value;
            if (!reps || !currentExercise) return;
            
            let details = `回数: ${reps}回`;
            if (weight) {
                details = `重量: ${weight}kg, ${details}`;
            }
            
            addToLog(currentExercise, details);
            resetSelection();
        }

        function recordSSC() {
            const time = document.getElementById('ssc-time').value;
            if (!time || !currentExercise) return;
            
            addToLog(currentExercise, `運動時間: ${time}分`);
            resetSelection();
        }

        function recordOther() {
            const time = document.getElementById('other-time').value;
            if (!time || !currentExercise) return;
            
            addToLog(currentExercise, `運動時間: ${time}分`);
            resetSelection();
        }

        function addToLog(exerciseName, details) {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                             now.getMinutes().toString().padStart(2, '0');
            
            const logEntry = {
                exercise: exerciseName,
                details: details,
                time: timeString,
                timestamp: now.getTime()
            };
            
            let workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
            workoutLog.push(logEntry);
            localStorage.setItem('workoutLog', JSON.stringify(workoutLog));
            
            displayLog();
            
            if (document.getElementById('calendar-tab').classList.contains('active')) {
                renderCalendar();
            }
        }

        function displayLog() {
            const logContainer = document.getElementById('log-container');
            const workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
            
            if (workoutLog.length === 0) {
                logContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">まだ記録がありません</p>';
                return;
            }
            
            const today = new Date().toDateString();
            const todayLogs = workoutLog.filter((entry, index) => {
                const entryDate = new Date(entry.timestamp).toDateString();
                return entryDate === today;
            }).map((entry, filteredIndex) => {
                const originalIndex = workoutLog.findIndex(logEntry => 
                    logEntry.timestamp === entry.timestamp && 
                    logEntry.exercise === entry.exercise && 
                    logEntry.details === entry.details
                );
                return { ...entry, originalIndex };
            });
            
            logContainer.innerHTML = todayLogs.map((entry, index) => `
                <div class="log-entry" data-index="${entry.originalIndex}">
                    <button class="delete-btn" onclick="deleteEntry(${entry.originalIndex})" title="削除">×</button>
                    <div class="date">${entry.time}</div>
                    <div class="exercise-name">${entry.exercise}</div>
                    <div class="details">${entry.details}</div>
                </div>
            `).join('');
            
            if (todayLogs.length === 0) {
                logContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">今日はまだ記録がありません</p>';
            }
        }

        function deleteEntry(index) {
            if (confirm('この記録を削除しますか？')) {
                let workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
                workoutLog.splice(index, 1);
                localStorage.setItem('workoutLog', JSON.stringify(workoutLog));
                displayLog();
                
                if (document.getElementById('calendar-tab').classList.contains('active')) {
                    renderCalendar();
                }
            }
        }

        function clearLog() {
            if (confirm('今日の記録をすべて削除しますか？')) {
                const workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
                const today = new Date().toDateString();
                const filteredLog = workoutLog.filter(entry => {
                    const entryDate = new Date(entry.timestamp).toDateString();
                    return entryDate !== today;
                });
                localStorage.setItem('workoutLog', JSON.stringify(filteredLog));
                displayLog();
            }
        }

        function resetSelection() {
            currentExercise = '';
            currentType = '';
            document.querySelectorAll('.exercise-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelectorAll('.input-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('cardio-time').value = '';
            document.getElementById('strength-weight').value = '';
            document.getElementById('strength-reps').value = '';
            document.getElementById('ssc-time').value = '';
            document.getElementById('other-time').value = '';
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            
            const minDate = new Date();
            minDate.setMonth(minDate.getMonth() - 6);
            
            if (currentYear < minDate.getFullYear() || 
                (currentYear === minDate.getFullYear() && currentMonth < minDate.getMonth())) {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                return;
            }
            
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            
            const today = new Date();
            if (currentYear > today.getFullYear() || 
                (currentYear === today.getFullYear() && currentMonth > today.getMonth())) {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                return;
            }
            
            renderCalendar();
        }

        function renderCalendar() {
            const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月',
                              '7月', '8月', '9月', '10月', '11月', '12月'];
            
            document.getElementById('calendar-title').textContent = 
                `${currentYear}年${monthNames[currentMonth]}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';
            
            const workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
            const workoutData = {};
            
            workoutLog.forEach(entry => {
                const date = new Date(entry.timestamp);
                const dateString = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                
                if (!workoutData[dateString]) {
                    workoutData[dateString] = new Set();
                }
                
                const cardioExercises = ['エアロバイク', 'ランニング', '散歩'];
                const strengthExercises = ['BSQ', 'デッドリフト', 'ダンベルプレス', '腹筋ローラー'];
                const sscExercises = ['SSC上半身', 'SSC下半身'];
                const otherExercises = ['ストレッチ'];
                
                if (cardioExercises.includes(entry.exercise)) {
                    workoutData[dateString].add('cardio');
                } else if (strengthExercises.includes(entry.exercise)) {
                    workoutData[dateString].add('strength');
                } else if (sscExercises.includes(entry.exercise)) {
                    workoutData[dateString].add('ssc');
                } else if (otherExercises.includes(entry.exercise)) {
                    workoutData[dateString].add('other');
                }
            });
            
            const today = new Date();
            const todayString = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                const dateString = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                
                if (date.getMonth() !== currentMonth) {
                    dayElement.classList.add('other-month');
                }
                
                if (dateString === todayString) {
                    dayElement.classList.add('today');
                }
                
                if (workoutData[dateString]) {
                    dayElement.classList.add('has-workout');
                    
                    const exerciseTypes = Array.from(workoutData[dateString]);
                    const indicator = document.createElement('div');
                    indicator.className = 'exercise-indicator';
                    
                    if (exerciseTypes.length === 1) {
                        indicator.classList.add(exerciseTypes[0] + '-indicator');
                    } else if (exerciseTypes.length === 2) {
                        // Fixed order to match CSS class definitions
                        const typeOrder = ['cardio', 'strength', 'ssc', 'other'];
                        const sortedTypes = exerciseTypes.sort((a, b) => typeOrder.indexOf(a) - typeOrder.indexOf(b));
                        indicator.classList.add(sortedTypes.join('-'));
                    } else if (exerciseTypes.length === 3) {
                        // Fixed order to match CSS class definitions
                        const typeOrder = ['cardio', 'strength', 'ssc', 'other'];
                        const sortedTypes = exerciseTypes.sort((a, b) => typeOrder.indexOf(a) - typeOrder.indexOf(b));
                        
                        // Generate class name based on the order defined in CSS
                        if (sortedTypes.includes('cardio') && sortedTypes.includes('ssc') && sortedTypes.includes('strength')) {
                            indicator.classList.add('cardio-ssc-strength');
                        } else if (sortedTypes.includes('cardio') && sortedTypes.includes('other') && sortedTypes.includes('strength')) {
                            indicator.classList.add('cardio-other-strength');
                        } else if (sortedTypes.includes('cardio') && sortedTypes.includes('other') && sortedTypes.includes('ssc')) {
                            indicator.classList.add('cardio-other-ssc');
                        } else if (sortedTypes.includes('other') && sortedTypes.includes('ssc') && sortedTypes.includes('strength')) {
                            indicator.classList.add('other-ssc-strength');
                        }
                    } else if (exerciseTypes.length === 4) {
                        indicator.classList.add('all-types');
                    }
                    
                    dayElement.appendChild(indicator);
                }
                
                calendarDays.appendChild(dayElement);
            }
            
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const today = new Date();
            const minDate = new Date();
            minDate.setMonth(minDate.getMonth() - 6);
            
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentYear < minDate.getFullYear() || 
                             (currentYear === minDate.getFullYear() && currentMonth <= minDate.getMonth());
            
            nextBtn.disabled = currentYear > today.getFullYear() || 
                             (currentYear === today.getFullYear() && currentMonth >= today.getMonth());
        }

        function updateStats() {
            const workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
            
            // Total workouts
            document.getElementById('total-workouts').textContent = workoutLog.length;
            
            // Total time
            let totalTime = 0;
            workoutLog.forEach(entry => {
                const timeMatch = entry.details.match(/運動時間:\s*(\d+)分/);
                if (timeMatch) {
                    totalTime += parseInt(timeMatch[1]);
                }
            });
            document.getElementById('total-time').textContent = totalTime;
            
            // Current streak
            const streak = calculateStreak(workoutLog);
            document.getElementById('current-streak').textContent = streak;
            
            // Weekly average
            const weeklyAvg = calculateWeeklyAverage(workoutLog);
            document.getElementById('weekly-avg').textContent = weeklyAvg.toFixed(1);
            
            // Charts
            updateWeeklyChart(workoutLog);
            updateMonthlyChart(workoutLog);
        }

        function calculateStreak(workoutLog) {
            if (workoutLog.length === 0) return 0;
            
            const today = new Date();
            const dates = new Set();
            
            workoutLog.forEach(entry => {
                const date = new Date(entry.timestamp);
                const dateString = date.toDateString();
                dates.add(dateString);
            });
            
            let streak = 0;
            let checkDate = new Date(today);
            
            while (dates.has(checkDate.toDateString())) {
                streak++;
                checkDate.setDate(checkDate.getDate() - 1);
            }
            
            return streak;
        }

        function calculateWeeklyAverage(workoutLog) {
            if (workoutLog.length === 0) return 0;
            
            const oldest = Math.min(...workoutLog.map(entry => entry.timestamp));
            const now = Date.now();
            const weeks = Math.max(1, Math.ceil((now - oldest) / (7 * 24 * 60 * 60 * 1000)));
            
            return workoutLog.length / weeks;
        }

        function updateWeeklyChart(workoutLog) {
            const weekDays = ['日', '月', '火', '水', '木', '金', '土'];
            const weekCounts = new Array(7).fill(0);
            
            workoutLog.forEach(entry => {
                const date = new Date(entry.timestamp);
                weekCounts[date.getDay()]++;
            });
            
            const maxCount = Math.max(...weekCounts) || 1;
            const chartHtml = weekDays.map((day, index) => `
                <div class="chart-bar">
                    <div class="chart-label">${day}</div>
                    <div class="chart-bar-fill" style="width: ${(weekCounts[index] / maxCount) * 200}px;"></div>
                    <div class="chart-value">${weekCounts[index]}</div>
                </div>
            `).join('');
            
            document.getElementById('weekly-chart').innerHTML = chartHtml;
        }

        function updateMonthlyChart(workoutLog) {
            const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月',
                              '7月', '8月', '9月', '10月', '11月', '12月'];
            const monthCounts = new Array(12).fill(0);
            
            workoutLog.forEach(entry => {
                const date = new Date(entry.timestamp);
                monthCounts[date.getMonth()]++;
            });
            
            const maxCount = Math.max(...monthCounts) || 1;
            const chartHtml = monthNames.map((month, index) => `
                <div class="chart-bar">
                    <div class="chart-label">${month}</div>
                    <div class="chart-bar-fill" style="width: ${(monthCounts[index] / maxCount) * 200}px;"></div>
                    <div class="chart-value">${monthCounts[index]}</div>
                </div>
            `).join('');
            
            document.getElementById('monthly-chart').innerHTML = chartHtml;
        }

        function updateProgress() {
            const workoutLog = JSON.parse(localStorage.getItem('workoutLog') || '[]');
            const exercises = ['BSQ', 'デッドリフト', 'ダンベルプレス', '腹筋ローラー', 'エアロバイク', 'ランニング', '散歩', 'SSC上半身', 'SSC下半身', 'ストレッチ'];
            
            const progressData = exercises.map(exercise => {
                const entries = workoutLog.filter(entry => entry.exercise === exercise);
                if (entries.length < 2) return null;
                
                const latest = entries[entries.length - 1];
                const previous = entries[entries.length - 2];
                
                return {
                    exercise,
                    latest: latest.details,
                    previous: previous.details,
                    change: calculateChange(previous.details, latest.details)
                };
            }).filter(item => item !== null);
            
            const progressList = document.getElementById('progress-list');
            
            if (progressData.length === 0) {
                progressList.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">進捗データが不十分です</p>';
                return;
            }
            
            const progressHtml = progressData.map(item => `
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-exercise">${item.exercise}</div>
                        <div class="progress-change ${item.change.type}">${item.change.text}</div>
                    </div>
                    <div>前回: ${item.previous}</div>
                    <div>最新: ${item.latest}</div>
                </div>
            `).join('');
            
            progressList.innerHTML = progressHtml;
        }

        function calculateChange(previous, latest) {
            // Extract numbers for comparison
            const prevWeight = parseFloat((previous.match(/重量:\s*([\d.]+)kg/) || [0, 0])[1]);
            const latestWeight = parseFloat((latest.match(/重量:\s*([\d.]+)kg/) || [0, 0])[1]);
            const prevReps = parseInt((previous.match(/回数:\s*(\d+)回/) || [0, 0])[1]);
            const latestReps = parseInt((latest.match(/回数:\s*(\d+)回/) || [0, 0])[1]);
            const prevTime = parseInt((previous.match(/運動時間:\s*(\d+)分/) || [0, 0])[1]);
            const latestTime = parseInt((latest.match(/運動時間:\s*(\d+)分/) || [0, 0])[1]);
            
            if (latestWeight && prevWeight) {
                if (latestWeight > prevWeight) return { type: 'progress-up', text: '↗ 重量アップ' };
                if (latestWeight < prevWeight) return { type: 'progress-down', text: '↘ 重量ダウン' };
            }
            
            if (latestReps && prevReps) {
                if (latestReps > prevReps) return { type: 'progress-up', text: '↗ 回数アップ' };
                if (latestReps < prevReps) return { type: 'progress-down', text: '↘ 回数ダウン' };
            }
            
            if (latestTime && prevTime) {
                if (latestTime > prevTime) return { type: 'progress-up', text: '↗ 時間アップ' };
                if (latestTime < prevTime) return { type: 'progress-down', text: '↘ 時間ダウン' };
            }
            
            return { type: 'progress-same', text: '→ 変化なし' };
        }

        function saveFavorite() {
            const name = document.getElementById('favorite-name').value.trim();
            if (!name) {
                alert('お気に入り名を入力してください');
                return;
            }
            
            if (favoriteBuilder.length === 0) {
                alert('運動を追加してください');
                return;
            }
            
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            favorites.push({
                name,
                exercises: [...favoriteBuilder],
                created: Date.now()
            });
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            document.getElementById('favorite-name').value = '';
            favoriteBuilder = [];
            updateFavoriteBuilder();
            displayFavorites();
        }

        function displayFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const favoritesList = document.getElementById('favorites-list');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">お気に入りがありません</p>';
                return;
            }
            
            const favoritesHtml = favorites.map((favorite, index) => `
                <div class="favorite-item">
                    <div class="favorite-name">${favorite.name}</div>
                    <div class="favorite-exercises">${favorite.exercises.map(ex => ex.exercise).join(', ')}</div>
                    <div class="favorite-actions">
                        <button class="favorite-btn use-favorite" onclick="useFavorite(${index})">使用</button>
                        <button class="favorite-btn delete-favorite" onclick="deleteFavorite(${index})">削除</button>
                    </div>
                </div>
            `).join('');
            
            favoritesList.innerHTML = favoritesHtml;
        }

        function useFavorite(index) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const favorite = favorites[index];
            
            favorite.exercises.forEach(exercise => {
                addToLog(exercise.exercise, exercise.details);
            });
            
            displayLog();
        }

        function deleteFavorite(index) {
            if (confirm('このお気に入りを削除しますか？')) {
                const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                favorites.splice(index, 1);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                displayFavorites();
            }
        }

        function updateFavoriteBuilder() {
            const builder = document.getElementById('favorite-builder');
            if (favoriteBuilder.length === 0) {
                builder.innerHTML = '<p>運動を選択してお気に入りに追加してください</p>';
                return;
            }
            
            const builderHtml = favoriteBuilder.map((item, index) => `
                <div style="background: #f0f0f0; padding: 8px; margin: 5px 0; border-radius: 4px; display: flex; justify-content: space-between;">
                    <span>${item.exercise}: ${item.details}</span>
                    <button onclick="removeFromBuilder(${index})" style="background: none; border: none; color: #f44336;">×</button>
                </div>
            `).join('');
            
            builder.innerHTML = builderHtml;
        }

        function removeFromBuilder(index) {
            favoriteBuilder.splice(index, 1);
            updateFavoriteBuilder();
        }

        // Override record functions to add to favorite builder when in favorites tab
        const originalRecordCardio = recordCardio;
        const originalRecordStrength = recordStrength;
        const originalRecordOther = recordOther;

        recordCardio = function() {
            originalRecordCardio();
            if (document.getElementById('favorites-tab').classList.contains('active')) {
                const time = document.getElementById('cardio-time').value;
                favoriteBuilder.push({
                    exercise: currentExercise,
                    details: `運動時間: ${time}分`
                });
                updateFavoriteBuilder();
            }
        };

        recordStrength = function() {
            originalRecordStrength();
            if (document.getElementById('favorites-tab').classList.contains('active')) {
                const weight = document.getElementById('strength-weight').value;
                const reps = document.getElementById('strength-reps').value;
                let details = `回数: ${reps}回`;
                if (weight) {
                    details = `重量: ${weight}kg, ${details}`;
                }
                favoriteBuilder.push({
                    exercise: currentExercise,
                    details: details
                });
                updateFavoriteBuilder();
            }
        };

        recordSSC = function() {
            if (document.getElementById('favorites-tab').classList.contains('active')) {
                const time = document.getElementById('ssc-time').value;
                favoriteBuilder.push({
                    exercise: currentExercise,
                    details: `運動時間: ${time}分`
                });
                updateFavoriteBuilder();
            } else {
                const time = document.getElementById('ssc-time').value;
                if (!time || !currentExercise) return;
                
                addToLog(currentExercise, `運動時間: ${time}分`);
                resetSelection();
            }
        };

        recordOther = function() {
            originalRecordOther();
            if (document.getElementById('favorites-tab').classList.contains('active')) {
                const time = document.getElementById('other-time').value;
                favoriteBuilder.push({
                    exercise: currentExercise,
                    details: `運動時間: ${time}分`
                });
                updateFavoriteBuilder();
            }
        };

        document.querySelectorAll('.exercise-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const exercise = this.dataset.exercise;
                const type = this.dataset.type;
                selectExercise(exercise, type);
            });
        });

        window.addEventListener('load', function() {
            // Load dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                toggleDarkMode();
            }
            
            displayLog();
            renderCalendar();
            updateStats();
        });
    </script>
</body>
</html>
